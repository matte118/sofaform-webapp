<div class="gestione-componenti-container">
  <p-toast></p-toast>

  <div class="page-header">
    <h1>Gestione Componenti</h1>
    <p>Gestisci i componenti del catalogo prodotti</p>
  </div>

  <div class="component-form-card">
    <h2>{{ formTitle }}</h2>
    <form class="component-form">
      <div class="form-row">
        <div class="form-group">
          <label for="componentName">Nome</label>
          <input pInputText id="componentName" type="text" [(ngModel)]="newComponent.name" name="name"
            placeholder="Nome del componente" />
        </div>

        <div class="form-group">
          <label for="componentPrice">Prezzo</label>
          <p-inputNumber id="componentPrice" [(ngModel)]="newComponent.price" name="price" [minFractionDigits]="2"
            [maxFractionDigits]="2" mode="currency" currency="EUR" locale="it-IT">
          </p-inputNumber>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="componentSuppliers">Fornitore</label>
          <p-dropdown id="componentSuppliers" [options]="availableSuppliers" [(ngModel)]="selectedSupplier"
            optionLabel="name" placeholder="Seleziona fornitore" [showClear]="true" name="supplier"
            styleClass="w-100">
          </p-dropdown>
        </div>

        <div class="form-group">
          <label for="componentType">Tipo di Componente</label>
          <p-dropdown id="componentType" [options]="availableComponentTypes" [(ngModel)]="selectedComponentType"
            optionLabel="name" placeholder="Seleziona tipo (opzionale)" [showClear]="true" name="componentType"
            styleClass="w-100"></p-dropdown>
        </div>
      </div>

      <div class="form-actions">
        <p-button [label]="submitButtonLabel" (onClick)="addComponent()" styleClass="primary-button"></p-button>
        <p-button *ngIf="isEditing" label="Annulla" (onClick)="resetForm()" styleClass="secondary-button"></p-button>
      </div>
    </form>
  </div>

  <div class="component-table-section">
    <h3>Lista Componenti</h3>
    <p-table [value]="components" styleClass="p-datatable-sm" [paginator]="true" [rows]="10"
      [globalFilterFields]="['name', 'price']" [rowHover]="true" #dt>
      <ng-template pTemplate="caption">
        <div class="table-header">
          <h4>Componenti ({{ components.length }})</h4>
          <div class="search-container">
            <input pInputText type="text" placeholder="Cerca componente..."
              (input)="dt.filterGlobal($any($event.target).value, 'contains')" />
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th>Nome</th>
          <th>Prezzo</th>
          <th>Fornitori</th>
          <th>Azioni</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-component let-i="rowIndex">
        <tr>
          <td>{{ component.name }}</td>
          <td>{{ component.price | currency:'EUR' }}</td>
          <td>
            <span *ngFor="let supplier of component.suppliers; let last = last">
              {{ supplier.name }}<span *ngIf="!last">, </span>
            </span>
            <span *ngIf="!component.suppliers.length" class="no-suppliers">
              Nessun fornitore
            </span>
          </td>
          <td class="actions-cell">
            <button pButton type="button" icon="pi pi-pencil" styleClass="icon-edit"
              (click)="editComponent(component, i)" pTooltip="Modifica"></button>
            <button pButton type="button" icon="pi pi-trash" styleClass="icon-delete"
              (click)="deleteComponent(component)" pTooltip="Elimina"></button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4" class="empty-message">
            Nessun componente trovato
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-confirmDialog header="Conferma"></p-confirmDialog>
</div>