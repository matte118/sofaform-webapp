<div class="home">
  <h1>Il nostro catalogo</h1>

  <div *ngIf="products.length === 0" class="empty-state">
    <i class="pi pi-inbox"></i>
    <p>Nessun prodotto aggiunto.</p>
  </div>

  <div class="p-grid p-align-start p-mt-4" *ngIf="products.length > 0">
    <div class="p-col-12 p-sm-6 p-md-4" *ngFor="let product of products; trackBy: trackById">
      <p-card
        [header]="product.name"
        [subheader]="'Prezzo medio: € ' + getTotalPrice(product.id).toFixed(2)"
        styleClass="product-card"
      >
        <div class="card-actions">
          <button pButton class="p-button-rounded p-button-text" 
            icon="pi pi-pencil"
            (click)="editProduct(product)">
          </button>
          <button pButton class="p-button-rounded p-button-danger p-button-text" 
            icon="pi pi-trash"
            (click)="deleteProduct($event, product)">
          </button>
        </div>
        <ng-template pTemplate="content">
          <p *ngIf="product.description" class="product-description">
            {{ product.description }}
          </p>
          
          <h4 class="variants-title">Varianti</h4>
          <ul class="variants-list">
            <li *ngFor="let variant of getProductVariants(product.id)">
              <div class="variant-info">
                <span class="variant-name">{{ variant.longName }}</span>
                <small *ngIf="variant.code">({{ variant.code }})</small>
              </div>
              <div class="variant-meta">
                <span class="variant-price">€ {{ variant.price.toFixed(2) }}</span>
                <small *ngIf="variant.seatsCount" class="variant-seats">
                  {{ variant.seatsCount }} posti
                </small>
              </div>
            </li>
          </ul>
        </ng-template>

        <ng-template pTemplate="footer">
          <button pButton type="button" label="Genera Listino" (click)="generaListino(product)"></button>
        </ng-template>
      </p-card>
    </div>
  </div>
</div>

<p-dialog 
  [(visible)]="showMarkupDialog" 
  header="Configura Ricarico" 
  [modal]="true" 
  [style]="{width: '450px'}">
  <div class="p-fluid">
    <div class="p-field">
      <label for="markup">Percentuale di Ricarico</label>
      <p-inputNumber 
        id="markup" 
        [(ngModel)]="markupPercentage" 
        mode="decimal" 
        [showButtons]="true"
        [min]="0" 
        [max]="100" 
        suffix="%">
      </p-inputNumber>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button 
      label="Annulla" 
      (onClick)="cancelMarkup()" 
      styleClass="p-button-text">
    </p-button>
    <p-button 
      label="Genera" 
      (onClick)="generateWithMarkup()">
    </p-button>
  </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
