<div class="gestione-tessuti-container">
  <p-toast></p-toast>

  <div class="page-header">
    <h1>Gestione Tessuti</h1>
    <p>Gestisci i tessuti per i rivestimenti dei divani</p>
  </div>

  <div class="tessuto-form-card" [ngClass]="{ 'editing-mode': isEditing }">
    <h2>{{ formTitle }}</h2>
    <form class="tessuto-form" #tessutoForm="ngForm">
      <div class="form-row">
        <div class="form-group">
          <label for="tessutoName">Nome Tessuto <span class="required-field">*</span></label>
          <input pInputText id="tessutoName" type="text" [(ngModel)]="newTessuto.name" name="name"
            placeholder="Categoria del tessuto..."
            [class.ng-invalid]="shouldShowFieldError(newTessuto.name)" />
          <small *ngIf="shouldShowFieldError(newTessuto.name)" class="p-error">
            Il nome del tessuto è obbligatorio
          </small>
        </div>

        <div class="form-group">
          <label for="tessutoPrice">Prezzo al Metro <span class="required-field">*</span> (€)</label>
          <p-inputNumber id="tessutoPrice" [(ngModel)]="newTessuto.mtPrice" name="mtPrice" [minFractionDigits]="2"
            [maxFractionDigits]="2" mode="currency" currency="EUR" locale="it-IT" [class.ng-invalid]="
              shouldShowFieldError(
                newTessuto.mtPrice > 0 ? newTessuto.mtPrice : null
              )
            ">
          </p-inputNumber>
          <small *ngIf="formSubmitted && !formValid && newTessuto.mtPrice <= 0" class="p-error">
            Il prezzo al metro deve essere maggiore di zero
          </small>
        </div>
      </div>

      <div class="form-actions">
        <p-button [label]="submitButtonLabel" (onClick)="addTessuto()" styleClass="primary-button"></p-button>
        <p-button *ngIf="isEditing" label="Annulla" (onClick)="resetForm()" styleClass="secondary-button"></p-button>
      </div>
    </form>
  </div>

  <div class="tessuto-table-section">
    <h3>Lista Tessuti</h3>

    <!-- Aggiungi messaggio di caricamento -->
    <div *ngIf="loading" class="loading-message">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <p>Caricamento tessuti...</p>
    </div>

    <p-table *ngIf="dataLoaded && !loading" #tessutoTable [value]="tessuti" styleClass="p-datatable-sm tessuti-table"
      [paginator]="true" [rows]="10" [globalFilterFields]="['name', 'mtPrice']" [rowHover]="true" #dt>
      <ng-template pTemplate="caption">
        <div class="table-header">
          <h4>Tessuti ({{ tessuti.length }})</h4>
          <div class="search-container">
            <input pInputText type="text" placeholder="Cerca tessuto..." (input)="onGlobalFilter($event, dt)" />
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th>Nome</th>
          <th>Prezzo al Metro</th>
          <th>Azioni</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-tessuto let-i="rowIndex">
        <tr>
          <td>{{ tessuto.name }}</td>
          <td>{{ tessuto.mtPrice | currency : "EUR" }}</td>
          <td class="actions-cell">
            <div class="action-buttons">
              <button pButton type="button" icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-sm action-edit" (click)="editTessuto(tessuto, i)"
                pTooltip="Modifica"></button>
              <button pButton type="button" icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-text p-button-sm action-delete"
                (click)="deleteTessuto(tessuto)" pTooltip="Elimina"></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3" class="empty-message">Nessun tessuto trovato</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-confirmDialog header="Conferma" [closable]="false"></p-confirmDialog>
</div>